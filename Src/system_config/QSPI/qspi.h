/*
 *
 */

#ifndef REALOP1_QSPI_H_
#define REALOP1_QSPI_H_

#include "stm32l476xx.h"
#include "../../globals.h"

#define QSPI_READY            2
#define QSPI_BUSY             1
#define QSPI_SUCCESSFUL       0
#define QSPI_TIMEDOUT        -1
#define QSPI_TRANSFER_ERROR  -2

#define QSPI_DMA_UNAVAILABLE  false		// TODO

#define QSPI_TIMEOUT_PERIOD  1000000	// TODO


#define qspi_on()	   RCC->AHB3ENR |= RCC_AHB3ENR_QSPIEN
#define qspi_off()	   RCC->AHB3ENR &= ~RCC_AHB3ENR_QSPIEN;
#define qspi_enable()  QUADSPI->CR |=   QUADSPI_CR_EN
#define qspi_disable() QUADSPI->CR &= ~(QUADSPI_CR_EN)

int get_qspi_status();

void qspi_config(uint8_t flash_size);

bool qspi_set_command(
		uint8_t fmode,
		uint8_t imode,
		uint8_t admode,
		uint8_t abmode,
		uint8_t dcyc,
		uint8_t dmode,
		bool    dma
);

bool qspi_send_command(
		uint8_t  instruction,
		uint32_t address,
		uint32_t data_length,
		uint8_t  *data,
		bool     r_or_w,
		uint32_t timeout_period,
		bool     dma
);

bool qspi_status_poll(
		uint8_t  instruction,
		uint8_t  mask,
		uint8_t  match,
		uint32_t timeout_period
);

#endif
